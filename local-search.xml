<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Resampling</title>
    <link href="/2024/01/04/Resampling/"/>
    <url>/2024/01/04/Resampling/</url>
    
    <content type="html"><![CDATA[<p>Dealing with <strong>Imbalanced Data Distribution</strong> is crucial in machine learning as it affects the performance of the model on both majority and minority classes.<br>This blog will introduce resampling techniques for handling unbalanced datasets and their implementation in <strong>Pytorch</strong>.</p><h1 id="Imbalanced-Dataset"><a href="#Imbalanced-Dataset" class="headerlink" title="Imbalanced Dataset"></a>Imbalanced Dataset</h1><pre><code class="hljs">å¦‚æœæ•°æ®é›†ä¸­æŸä¸ªç±»åˆ«è¿‡å¤šï¼Œåˆ™åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ¨¡å‹å¯èƒ½ä¼šæ›´å€¾å‘äºé€‰æ‹©å¤šæ•°ç±»åˆ«ï¼Œæ­¤æ—¶æ¨¡å‹æ›´å®¹æ˜“å­¦åˆ°æµ…å±‚çš„æ— å…³çš„ç‰¹å¾ä»¥åŒºåˆ†ä¸åŒç±»åˆ«ï¼Œä»¥è‡³äºåœ¨å°‘æ•°ç±»åˆ«çš„é¢„æµ‹ä¸Šè¡¨ç°ä¸ä½³ã€‚ä¸ºäº†ç¡®ä¿æ¨¡å‹ä¸ä¼šæ›´å€¾å‘äºé¢„æµ‹å¤šæ•°ç±»ï¼Œç¡®ä¿æ¨¡å‹åœ¨å°‘æ•°ç±»ä¸Šçš„è¡¨ç°ï¼Œéœ€è¦å¯¹æ•°æ®é›†è¿›è¡Œå¹³è¡¡ã€‚</code></pre><h1 id="Resampling-Techniques"><a href="#Resampling-Techniques" class="headerlink" title="Resampling Techniques"></a>Resampling Techniques</h1><pre><code class="hljs">å¹³è¡¡ç±»åˆ«åˆ†å¸ƒï¼šå¯¹å å°‘æ•°çš„ç±»åˆ«è¿›è¡Œä¸Šé‡‡æ ·ï¼Œæˆ–è€…å¯¹å å¤šæ•°çš„ç±»åˆ«è¿›è¡Œä¸‹é‡‡æ ·ã€‚   Resampling involves adjusting the number of samples in each class to balance the class distribution. There are two main techniques: oversampling and undersampling. PyTorch provides a convenient way to perform resampling using the </code></pre><h2 id="pytorchä¸­çš„é‡‡æ ·å‡½æ•°"><a href="#pytorchä¸­çš„é‡‡æ ·å‡½æ•°" class="headerlink" title="pytorchä¸­çš„é‡‡æ ·å‡½æ•°"></a>pytorchä¸­çš„é‡‡æ ·å‡½æ•°</h2><p>å¸¸ç”¨åˆ°<code>torch.utils.data.WeightedRandomSampler</code></p><p>è¯¥å‡½æ•°æä¾›äº†<strong>ä¸Šé‡‡æ ·</strong>(oversampling)å’Œ<strong>ä¸‹é‡‡æ ·</strong>(undersampling)ä¸¤ç§é‡‡æ ·æ–¹æ³•</p><h3 id="Argsè¯´æ˜"><a href="#Argsè¯´æ˜" class="headerlink" title="Argsè¯´æ˜"></a><strong>Args</strong>è¯´æ˜</h3><p><code>torch.utils.data.WeightedRandomSampler(weights, num_samples, replacement=True, generator=None)</code>  </p><h4 id="weights"><a href="#weights" class="headerlink" title="weights:"></a>weights:</h4><pre><code class="hljs">å¯¹æ•°æ®é›†ä¸­ä¸‹è¡¨içš„æ ·æœ¬ä»¥weights[i]çš„æ¦‚ç‡è¿›è¡Œé‡‡æ ·</code></pre><h4 id="num-samples"><a href="#num-samples" class="headerlink" title="num_samples:"></a>num_samples:</h4><pre><code class="hljs">è®­ç»ƒé›†å¤§å°</code></pre><h4 id="replacement"><a href="#replacement" class="headerlink" title="replacement:"></a>replacement:</h4><pre><code class="hljs">true:æ¯ä¸ªæ ·æœ¬å¯èƒ½è¢«é‡å¤é‡‡æ ·  false:æ¯ä¸ªæ ·æœ¬åªä¼šè¢«é‡‡æ ·ä¸€æ¬¡</code></pre><h4 id="generator-æ²¡ç”¨è¿‡"><a href="#generator-æ²¡ç”¨è¿‡" class="headerlink" title="generator:  (æ²¡ç”¨è¿‡)"></a>generator:  (æ²¡ç”¨è¿‡)</h4><pre><code class="hljs">Specifies the random number generator to use. If None, the global PyTorch generator is used. You can provide a custom generator for reproducibility purposes.  </code></pre><h2 id="Undersampling"><a href="#Undersampling" class="headerlink" title="Undersampling"></a>Undersampling</h2><h3 id="è®¡ç®—æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬ä¸ªæ•°"><a href="#è®¡ç®—æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬ä¸ªæ•°" class="headerlink" title="è®¡ç®—æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬ä¸ªæ•°"></a>è®¡ç®—æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬ä¸ªæ•°</h3><p><code>class_counts = [count_class_0, count_class_1]</code>  </p><h3 id="è®¡ç®—æ¯ä¸ªç±»åˆ«çš„é‡‡æ ·æƒé‡"><a href="#è®¡ç®—æ¯ä¸ªç±»åˆ«çš„é‡‡æ ·æƒé‡" class="headerlink" title="è®¡ç®—æ¯ä¸ªç±»åˆ«çš„é‡‡æ ·æƒé‡"></a>è®¡ç®—æ¯ä¸ªç±»åˆ«çš„é‡‡æ ·æƒé‡</h3><pre><code class="hljs">æ•°é‡è¶Šå¤šï¼Œé‡‡æ ·æƒé‡è¶Šå°ï¼Œå³ä»¥å°çš„æ¦‚ç‡å¯¹å¤§ç±»è¿›è¡Œé‡‡æ ·</code></pre><p><code>class_weights = 1./torch.tensor(class_counts, dtype = torch.float)</code></p><h3 id="å¯¹æ•°æ®é›†ä¸­æ¯ä¸ªæ ·æœ¬èµ‹é‡‡æ ·æƒé‡"><a href="#å¯¹æ•°æ®é›†ä¸­æ¯ä¸ªæ ·æœ¬èµ‹é‡‡æ ·æƒé‡" class="headerlink" title="å¯¹æ•°æ®é›†ä¸­æ¯ä¸ªæ ·æœ¬èµ‹é‡‡æ ·æƒé‡"></a>å¯¹æ•°æ®é›†ä¸­æ¯ä¸ªæ ·æœ¬èµ‹é‡‡æ ·æƒé‡</h3><p><code>weights = class_weights[y]</code><br><strong>æ­¤å¤„çš„<code>y = labels.numpy()</code></strong>  </p><p><em>æ³¨æ„ï¼š*<em>weightsçš„ä¸‹æ ‡éœ€è¦ä¸æ•°æ®é›†ä¸­æ ·æœ¬æ’åºç›¸å¯¹åº”ã€‚</em></em>  </p><h3 id="åˆå§‹åŒ–WeightedRandomSampler"><a href="#åˆå§‹åŒ–WeightedRandomSampler" class="headerlink" title="åˆå§‹åŒ–WeightedRandomSampler"></a>åˆå§‹åŒ–<code>WeightedRandomSampler</code></h3><p><code>sampler = WeightedRandomSampler(</code><br>    <code>weights,#æƒé‡åˆ—è¡¨</code><br>    <code>len(weights),#æ•°æ®é›†é•¿åº¦</code><br>    <code>replacements = False)#æ¯ä¸ªæ ·æœ¬åªä¼šè¢«é‡‡æ ·ä¸€æ¬¡</code>   </p><p><code>replacement = False</code> is typical behavior for undersampling, where you want to remove samples from the majority class.<br><strong>å¦‚æœè¢«é‡‡æ ·æ ·æœ¬æ•°å°äºnum_samplesï¼Œæ­¤æ—¶ä¼šæŠ¥é”™</strong><br><code>ValueError: Replacement turned off and num_samples not large enough to draw samples without replacement.</code></p><h3 id="å°†é‡‡æ ·å™¨ç”¨äºdataloader"><a href="#å°†é‡‡æ ·å™¨ç”¨äºdataloader" class="headerlink" title="å°†é‡‡æ ·å™¨ç”¨äºdataloader"></a>å°†é‡‡æ ·å™¨ç”¨äºdataloader</h3><pre><code class="hljs">dataset = CustomDataset(features, labels)dataloader = DataLoader(dataset, batch_size=32, sampler=sampler)</code></pre><h2 id="Oversampling"><a href="#Oversampling" class="headerlink" title="Oversampling"></a>Oversampling</h2><pre><code class="hljs">ä¸ä¸‹é‡‡æ ·ğŸ‘†çš„åŒºåˆ«ä»…åœ¨äºreplacement = True</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>pytorch</tag>
      
      <tag>resample</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pd.DataFrame and pd.read_csv</title>
    <link href="/2024/01/03/pandas/"/>
    <url>/2024/01/03/pandas/</url>
    
    <content type="html"><![CDATA[<p>This blog is about the key use and attributes of a famous data structure from pandas, pd.DataFrame, including fetch a row, column and element, as well as the transformation of List and DataFrame. </p><h2 id="ä¸€-è¯»å–æ•°æ®pd-read-csv-filepath"><a href="#ä¸€-è¯»å–æ•°æ®pd-read-csv-filepath" class="headerlink" title="ä¸€. è¯»å–æ•°æ®pd.read_csv(filepath)"></a>ä¸€. è¯»å–æ•°æ®<code>pd.read_csv(filepath)</code></h2><h3 id="1-Args-è¯´æ˜"><a href="#1-Args-è¯´æ˜" class="headerlink" title="1. Args è¯´æ˜"></a>1. Args è¯´æ˜</h3><ol><li><p><code>filePath = &#39;path/to/your/example.csv&#39;</code>  </p></li><li><p><strong>default</strong>å°†ç¬¬ä¸€è¡Œè¯»å–ä¸º<strong>åˆ—å¤´</strong>ï¼Œå¦‚æœç¬¬ä¸€åˆ—ä¸ºæ•°æ®ï¼Œåˆ™æŒ‡å®š <code>header=None</code>,æ­¤æ—¶ä¼šæ·»åŠ é»˜è®¤åˆ—å¤´(0,1,2,3,â€¦)</p></li></ol><h3 id="2-è¯»å–excelæ–‡ä»¶"><a href="#2-è¯»å–excelæ–‡ä»¶" class="headerlink" title="2. è¯»å–excelæ–‡ä»¶"></a>2. è¯»å–excelæ–‡ä»¶</h3><ol><li>ä½¿ç”¨å¦‚ä¸‹ä»£ç å°†excelè½¬åŒ–æˆcsv</li></ol><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nsis">file_path_excel = <span class="hljs-string">&#x27;path/to/your/example.xlsx&#x27;</span>  <span class="hljs-comment"># Specify the path to your Excel file</span><br>csv_output_path = <span class="hljs-string">&#x27;path/to/your/example.csv&#x27;</span>    <span class="hljs-comment"># Specify the desired path for the CSV output</span><br><br><span class="hljs-comment"># Convert Excel to CSV using Excel&#x27;s Save As feature or with pandas</span><br><span class="hljs-comment"># For example, you can use pandas to_csv method</span><br>df_excel = pd.read_excel(file_path_excel, sheet_name=<span class="hljs-string">&#x27;Sheet1&#x27;</span>)<br>df_excel.to_csv(csv_output_path, index=<span class="hljs-literal">False</span>)<br><br><span class="hljs-comment"># Now use pd.read_csv to read the CSV file</span><br>df_csv = pd.read_csv(csv_output_path)<br></code></pre></td></tr></table></figure><ol start="2"><li>æˆ–è€…ç›´æ¥æ›´æ”¹åç¼€xlsx-&gt;csv(å¯èƒ½å‡ºç°æ ¼å¼é”™è¯¯é—®é¢˜)</li></ol><h3 id="3-åˆ†éš”ç¬¦"><a href="#3-åˆ†éš”ç¬¦" class="headerlink" title="3. åˆ†éš”ç¬¦"></a>3. åˆ†éš”ç¬¦</h3><p>è¯¦æƒ…è¯·è§<a href="https://blog.csdn.net/weixin_50294842/article/details/122930229?spm=1001.2014.3001.5501">ä½¿ç”¨pd.read_csvçš„åˆ†éš”ç¬¦é—®é¢˜â€“æ¸…ä¸‰çš®</a></p><h2 id="äºŒ-pd-DataFrameç±»å‹"><a href="#äºŒ-pd-DataFrameç±»å‹" class="headerlink" title="äºŒ. pd.DataFrameç±»å‹"></a>äºŒ. pd.DataFrameç±»å‹</h2><h3 id="1-æ•´ä½“ä¿¡æ¯"><a href="#1-æ•´ä½“ä¿¡æ¯" class="headerlink" title="1. æ•´ä½“ä¿¡æ¯"></a>1. æ•´ä½“ä¿¡æ¯</h3><ol><li>è·å–å¤§å°<code>df.shape</code><br>Output (numbers of rows, numbers of columns)</li><li>åˆ—åç§°<code>df.columns</code></li><li>è¡Œåç§°<code>df.index</code></li><li>è¡¨å¤´<code>df.head()</code></li><li>ç»Ÿè®¡ä¸€åˆ—çš„å€¼ä¿¡æ¯<code>df[&#39;Normal/Attack&#39;].value_counts()</code></li></ol><h3 id="2-Access"><a href="#2-Access" class="headerlink" title="2. Access"></a>2. Access</h3><pre><code class="hljs">å¦‚æœéœ€è¦é€šè¿‡åç§°è®¿é—®ï¼Œåˆ™ä½¿ç”¨locå¦‚æœæ ¹æ®ç´¢å¼•è®¿é—®ï¼Œåˆ™ä½¿ç”¨iloc  ã€è¡¨å¤´ç®—æ˜¯ç¬¬0è¡Œã€‘</code></pre><ol><li><strong>æ ¹æ®åˆ—å</strong>è®¿é—®ä¸€åˆ—<br><code>df[&#39;col1_name&#39;]</code><br><code>df[[&#39;col1_name&#39;,&#39;col2_name&#39;]]</code>  </li><li><strong>æ ¹æ®ç´¢å¼•</strong>è®¿é—®ä¸€åˆ—<br><code>df.iloc[:,1]</code><strong>è®¿é—®ç¬¬äºŒåˆ—</strong></li><li>è®¿é—®ä¸€è¡Œ<br><code>df.iloc[1]</code><strong>è®¿é—®ç¬¬äºŒè¡Œ</strong>æ•ˆæœåŒ<code>df.iloc[1,:]</code><br>è®¿é—®å‡ è¡Œ<br><code>df.iloc[0:2]</code><strong>ilocå‡½æ•°å·¦é—­å³å¼€</strong></li><li>æŒ‰æ¡ä»¶è®¿é—®<br><code>df.loc[data.B&gt;6]</code></li></ol><h3 id="3-ç”¨Listæ–°å»ºä¸€åˆ—"><a href="#3-ç”¨Listæ–°å»ºä¸€åˆ—" class="headerlink" title="3. ç”¨Listæ–°å»ºä¸€åˆ—"></a>3. ç”¨Listæ–°å»ºä¸€åˆ—</h3><p><code>df[&#39;weight&#39;]=weight_list</code><br><code>weight_list = list(df[&#39;weight&#39;])</code></p><h3 id="4-æ–°å»ºDataFrame"><a href="#4-æ–°å»ºDataFrame" class="headerlink" title="4. æ–°å»ºDataFrame"></a>4. æ–°å»ºDataFrame</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">f1</span>=[<span class="hljs-number">99</span>.<span class="hljs-number">06</span>,<span class="hljs-number">99</span>.<span class="hljs-number">15</span>,<span class="hljs-number">97</span>.<span class="hljs-number">77</span>,<span class="hljs-number">98</span>.<span class="hljs-number">40</span>,<span class="hljs-number">99</span>.<span class="hljs-number">25</span>]<br><span class="hljs-attribute">precision</span>=[<span class="hljs-number">98</span>.<span class="hljs-number">97</span>,<span class="hljs-number">99</span>.<span class="hljs-number">18</span>,<span class="hljs-number">96</span>.<span class="hljs-number">67</span>,<span class="hljs-number">99</span>.<span class="hljs-number">80</span>,<span class="hljs-number">99</span>.<span class="hljs-number">52</span>]<br><span class="hljs-attribute">accuracy</span>=[<span class="hljs-number">99</span>.<span class="hljs-number">06</span>,<span class="hljs-number">99</span>.<span class="hljs-number">15</span>,<span class="hljs-number">97</span>.<span class="hljs-number">73</span>,<span class="hljs-number">98</span>.<span class="hljs-number">41</span>,<span class="hljs-number">99</span>.<span class="hljs-number">27</span>]<br><span class="hljs-attribute">recall</span>=[<span class="hljs-number">99</span>.<span class="hljs-number">16</span>,<span class="hljs-number">99</span>.<span class="hljs-number">12</span>,<span class="hljs-number">99</span>.<span class="hljs-number">98</span>,<span class="hljs-number">97</span>.<span class="hljs-number">03</span>,<span class="hljs-number">98</span>.<span class="hljs-number">99</span>]<br>  <br><span class="hljs-attribute">import</span> pandas as pd<br><span class="hljs-attribute">result</span>=pd.DataFrame(&#123;&#x27;f1&#x27;:f1,&#x27;recall&#x27;:recall,&#x27;precision&#x27;:precision,&#x27;accuracy&#x27;:accuracy&#125;).applymap(<span class="hljs-string">&quot;&#123;:.04f&#125;&quot;</span>.format)<br><span class="hljs-attribute">result</span>.loc[len(result)]=[sum(recall)/<span class="hljs-number">5</span>,sum(f1)/<span class="hljs-number">5</span>,sum(accuracy)/<span class="hljs-number">5</span>,sum(precision)/<span class="hljs-number">5</span>]<br><span class="hljs-attribute">result</span>.rename(index=&#123;<span class="hljs-number">5</span>:&#x27;average&#x27;&#125;,inplace=True)<br><span class="hljs-attribute">result</span><br><br></code></pre></td></tr></table></figure><p><strong>output</strong><br><img src="/../image/post/DataFrame.png" alt="dataframe"></p>]]></content>
    
    
    
    <tags>
      
      <tag>pandas</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>the basic use of Pytorch</title>
    <link href="/2024/01/02/pytorch/"/>
    <url>/2024/01/02/pytorch/</url>
    
    <content type="html"><![CDATA[<p>This blog is written to introduce the basic use of pytorch, including the construction of custom dataset and neural network, as well as the function of training and validation.</p><h2 id="ä¸€-è®­ç»ƒå‰"><a href="#ä¸€-è®­ç»ƒå‰" class="headerlink" title="ä¸€. è®­ç»ƒå‰"></a>ä¸€. è®­ç»ƒå‰</h2><h3 id="1-ä¼˜åŒ–å‡½æ•°ã€æŸå¤±å‡½æ•°é€‰æ‹©"><a href="#1-ä¼˜åŒ–å‡½æ•°ã€æŸå¤±å‡½æ•°é€‰æ‹©" class="headerlink" title="1. ä¼˜åŒ–å‡½æ•°ã€æŸå¤±å‡½æ•°é€‰æ‹©"></a>1. ä¼˜åŒ–å‡½æ•°ã€æŸå¤±å‡½æ•°é€‰æ‹©</h3><pre><code class="hljs">`import torch`    `from torch.utils.data import Dataset`</code></pre><ol><li><p><code>torch.nn</code>ä¸­æœ‰è¯¸å¤šæŸå¤±å‡½æ•°ï¼Œå¸¸ç”¨çš„å¦‚<code>loss_f = torch.nn.CrossEntropyLoss()</code>  </p></li><li><p><code>torch.optim</code>ä¸­ä¸ºä¼˜åŒ–å‡½æ•°ï¼Œå¸¸ç”¨çš„å¦‚<code>opt = torch.optim.Adam(module.parameters(),lr=learning_rate)</code>  </p><p> å…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ¨¡å‹çš„æ‰€æœ‰å‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¶…å‚æ•°å­¦ä¹ ç‡  </p></li><li><p>æ¨¡å‹çš„å‚æ•°å¯ç”±å¦‚ä¸‹ä»£ç è·å¾—,å¹¶ä¸”åœ¨è®­ç»ƒä¹‹å‰è®¾ç½®å‚æ•°ä¸ºå¯ä¼˜åŒ–<br> <code>for param in model.parameters():</code><br> <code>   param.requires_grad = True</code></p></li><li><p>å­¦ä¹ ç‡åœ¨è®­ç»ƒä¸­åŠ¨æ€è°ƒæ•´ï¼Œ<code>torch.optim.lr_scheduler</code>ä¸­å­˜æ”¾äº†è°ƒæ•´å‡½æ•°ï¼Œå¸¸ç”¨çš„å¦‚<code>scheduler = torch.optim.lr_scheduler.CosineAnnealingWarmRestarts(eta_min = 1e-6,optimizer = opt,T_0=5)</code></p></li></ol><h3 id="2-GPU"><a href="#2-GPU" class="headerlink" title="2. GPU"></a>2. GPU</h3><ol><li><p>é€‰æ‹©å¯ç”¨çš„GPU <code>device = &quot;cuda&quot; if torch.cuda.is_available() else &quot;cpu&quot; </code>  </p></li><li><p>å°†æ¨¡å‹ã€æŸå¤±å‡½æ•°ç§»åŠ¨åˆ°deviceä¸Š<br> <code>model = model.to(device=device)</code><br> <code>loss_f = loss_f.to(device=device)</code>  </p></li><li><p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å°†æ•°æ®ç§»åŠ¨åˆ°cudaä¸Šï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹  </p><p> <code>for batch, datas in enumerate(train_loader):</code><br> <code>   x, y = datas</code><br> <code>   if device == &#39;cuda&#39;: x, y = x.cuda(),y.cuda()</code></p></li></ol><h2 id="äºŒ-æ•°æ®é›†"><a href="#äºŒ-æ•°æ®é›†" class="headerlink" title="äºŒ. æ•°æ®é›†"></a>äºŒ. æ•°æ®é›†</h2><h3 id="1-ç»§æ‰¿torchè‡ªå¸¦çš„æ•°æ®é›†ç±»"><a href="#1-ç»§æ‰¿torchè‡ªå¸¦çš„æ•°æ®é›†ç±»" class="headerlink" title="1. ç»§æ‰¿torchè‡ªå¸¦çš„æ•°æ®é›†ç±»"></a>1. ç»§æ‰¿torchè‡ªå¸¦çš„æ•°æ®é›†ç±»</h3><pre><code class="hljs">`from torch.utils.data import Dataset`  </code></pre><h4 id="1-1-ç±»å£°æ˜"><a href="#1-1-ç±»å£°æ˜" class="headerlink" title="1.1 ç±»å£°æ˜"></a>1.1 ç±»å£°æ˜</h4><p>   <code>class yourDatasetName(Dataset):</code><br>   é‡å†™<br>   <code>def __init__(self,data,label) -&gt; None:</code><br>   <code>def __len__(self):</code><br>   <code>def __getitem__(self,idx)</code></p><h4 id="1-2-def-init-parameterâ€¦"><a href="#1-2-def-init-parameterâ€¦" class="headerlink" title="1.2 def init(parameterâ€¦)"></a>1.2 def <strong>init</strong>(parameterâ€¦)</h4><pre><code class="hljs">è¯¥å‡½æ•°ç”¨æä¾›çš„ï¼ˆå‚æ•°ï¼‰dataå’Œæ ‡ç­¾æ„å»ºæ•°æ®é›†ï¼Œè½¬åŒ–dataå’Œlabelä¸º`torch.tensorç»“æ„`ï¼ŒåŒæ—¶ä»¥ç±»æˆå‘˜çš„æ–¹å¼ä¿å­˜è½¬åŒ–åçš„ç»“æœã€‚</code></pre><h5 id="ä¸‰ç§å¸¸è§initæ–¹å¼"><a href="#ä¸‰ç§å¸¸è§initæ–¹å¼" class="headerlink" title="ä¸‰ç§å¸¸è§initæ–¹å¼"></a>ä¸‰ç§å¸¸è§initæ–¹å¼</h5><ol><li><p>ä¼ å…¥data,labelæ–¹å¼æ„å»º  </p><p><strong>Argsè¯´æ˜</strong><br><code>data (list or numpy array)</code><br><code>labels (list or numpy array)</code><br> <strong>è½¬æ¢</strong><br> <code>self.data = torch.tensor(data)</code><br> <code>self.labels = torch.tensor(labels)</code>  </p></li><li><p>ä¼ å…¥pd.DataFrameæ–¹å¼æ„å»º</p><p><strong>Argsè¯´æ˜</strong><br><code>dataframe : pd.DataFrame</code><br><code>datafram[&#39;labels&#39;]å­˜å‚¨æ ‡ç­¾ä¿¡æ¯</code><br><strong>è½¬æ¢</strong><br><code>self.data = torch.tensor(dataframe.values)</code><br><code>self.labels = torch.tensor(dataframe[&#39;labels&#39;].values)</code>  </p></li><li><p>ä¼ å…¥æ•°æ®é›†è·¯å¾„æ„å»º</p></li></ol><h4 id="1-3-def-len-self"><a href="#1-3-def-len-self" class="headerlink" title="1.3 def len(self)"></a>1.3 def <strong>len</strong>(self)</h4><pre><code class="hljs">è¯¥å‡½æ•°è¿”å›æ‰€æœ‰æ•°æ®é›†ä¸­æ ·æœ¬çš„æ€»æ•°ï¼Œè¯¥å‡½æ•°è¢«Dataloaderè°ƒç”¨ä»è€Œå†³å®šæ¯ä¸€ä¸ªepochçš„æ‰¹é‡å¤§å°</code></pre><p><code>return len(self.data)</code></p><h4 id="1-4-def-getitem-self-index"><a href="#1-4-def-getitem-self-index" class="headerlink" title="1.4 def getitem(self,index)"></a>1.4 def <strong>getitem</strong>(self,index)</h4><pre><code class="hljs">è¯¥å‡½æ•°æ ¹æ®ç»™å®šçš„indexè¿”å›ä¸‹æ ‡æ‰€æŒ‡çš„dataå’Œå¯¹åº”labelï¼Œè¢«Dataloaderè°ƒç”¨æ¥å–ç‰¹å®šçš„ä¸‹æ ‡å…ƒç´ ï¼Œè¿”å›çš„dataå’Œlabeléœ€è¦tupleå½¢å¼  </code></pre><p><code>return self.data[index],self.labels[index]</code></p><h3 id="2-DataLoader"><a href="#2-DataLoader" class="headerlink" title="2. DataLoader"></a>2. DataLoader</h3><pre><code class="hljs">from torch.utils.data import DataLoader  </code></pre><h4 id="2-1-å®ä¾‹åŒ–æ•°æ®é›†ç±»"><a href="#2-1-å®ä¾‹åŒ–æ•°æ®é›†ç±»" class="headerlink" title="2.1 å®ä¾‹åŒ–æ•°æ®é›†ç±»"></a>2.1 å®ä¾‹åŒ–æ•°æ®é›†ç±»</h4><p>   <code>my_dataset = yourDatasetName(args....)</code>  </p><h4 id="2-2-å‚æ•°"><a href="#2-2-å‚æ•°" class="headerlink" title="2.2 å‚æ•°"></a>2.2 å‚æ•°</h4><p>   <code>batch_size = 32</code>&#x2F;&#x2F;è¶Šå¤§è¶Šå¥½ï¼Œå¤§äº†å¯èƒ½gpuå—ä¸ä½<br>   <code>shuffle = True</code> &#x2F;&#x2F;åœ¨æ¯ä¸ªepochå¼€å§‹å‰æ‰“ä¹±ä¸€è¾¹æ•°æ®<br>   <code>num_workers = 2</code>  </p><h4 id="2-3-åˆ›å»ºDataLoader"><a href="#2-3-åˆ›å»ºDataLoader" class="headerlink" title="2.3 åˆ›å»ºDataLoader"></a>2.3 åˆ›å»ºDataLoader</h4><p>   <code>my_dataloader = DataLoader(my_dataset)</code> </p><h4 id="2-4-ä½¿ç”¨"><a href="#2-4-ä½¿ç”¨" class="headerlink" title="2.4 ä½¿ç”¨"></a>2.4 ä½¿ç”¨</h4><p>   <code>for batch_data, batch_labels in my_dataloader:</code>  </p><h2 id="ä¸‰-æ¨¡å‹é€‰æ‹©ä¸æ„å»º"><a href="#ä¸‰-æ¨¡å‹é€‰æ‹©ä¸æ„å»º" class="headerlink" title="ä¸‰. æ¨¡å‹é€‰æ‹©ä¸æ„å»º"></a>ä¸‰. æ¨¡å‹é€‰æ‹©ä¸æ„å»º</h2><pre><code class="hljs">import torchimport torch.nn as nnimport torch.nn.functional as F</code></pre><h3 id="1-è‡ªå·±æ„å»ºå­ç±»"><a href="#1-è‡ªå·±æ„å»ºå­ç±»" class="headerlink" title="1. è‡ªå·±æ„å»ºå­ç±»"></a>1. è‡ªå·±æ„å»ºå­ç±»</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNeuralNetwork</span>(nn.<span class="hljs-title class_">Module</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span>, input_size, hidden_size, output_size</span>):<br>        <span class="hljs-variable language_">super</span>(<span class="hljs-title class_">MyNeuralNetwork</span>, <span class="hljs-variable language_">self</span>).__init__()<br><br>        <span class="hljs-comment"># Define your layers</span><br>        <span class="hljs-variable language_">self</span>.fc1 = nn.<span class="hljs-title class_">Linear</span>(input_size, hidden_size)<br>        <span class="hljs-variable language_">self</span>.fc2 = nn.<span class="hljs-title class_">Linear</span>(hidden_size, output_size)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span>, x</span>):<br>        <span class="hljs-comment"># Define the forward pass</span><br>        x = F.relu(<span class="hljs-variable language_">self</span>.fc1(x))<br>        x = <span class="hljs-variable language_">self</span>.fc2(x)<br>        <span class="hljs-keyword">return</span> x<br></code></pre></td></tr></table></figure><ol><li>initæ–¹æ³•åˆå§‹åŒ–ç¥ç»ç½‘ç»œçš„æ‰€æœ‰å±‚  </li><li>forwardæ–¹æ³•å®šä¹‰å‰å‘ä¼ æ’­</li></ol><h3 id="2-æ®‹å·®å—"><a href="#2-æ®‹å·®å—" class="headerlink" title="2. æ®‹å·®å—"></a>2. æ®‹å·®å—</h3><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-type">Residual</span>(<span class="hljs-title">nn</span>.<span class="hljs-type">Module</span>):</span><br><span class="hljs-class">    def __init__(<span class="hljs-title">self</span>, <span class="hljs-title">input_channels</span>, <span class="hljs-title">output_channels</span>, <span class="hljs-title">conv1_stride</span>, <span class="hljs-title">conv2_stride</span>, <span class="hljs-title">use_1x1conv</span>=<span class="hljs-type">False</span>) -&gt; <span class="hljs-type">None</span>:</span><br><span class="hljs-class">        super().__init__()</span><br><span class="hljs-class">        self.conv1 = nn.<span class="hljs-type">Conv2d</span>(<span class="hljs-title">input_channels</span>, <span class="hljs-title">output_channels</span>,</span><br><span class="hljs-class">                               <span class="hljs-title">kernel_size</span>=(3, 1), padding=(1, 0),</span><br><span class="hljs-class">                               stride=conv1_stride)</span><br><span class="hljs-class">        self.conv2 = nn.<span class="hljs-type">Conv2d</span>(<span class="hljs-title">output_channels</span>, <span class="hljs-title">output_channels</span>,</span><br><span class="hljs-class">                               <span class="hljs-title">kernel_size</span>=(3, 1), padding=(1, 0),</span><br><span class="hljs-class">                               stride=conv2_stride)</span><br><span class="hljs-class">        self.bn1 = nn.<span class="hljs-type">BatchNorm2d</span>(<span class="hljs-title">output_channels</span>)</span><br><span class="hljs-class">        self.bn2 = nn.<span class="hljs-type">BatchNorm2d</span>(<span class="hljs-title">output_channels</span>)</span><br><span class="hljs-class">        if use_1x1conv:</span><br><span class="hljs-class">            self.conv1x1 = nn.<span class="hljs-type">Conv2d</span>(</span><br><span class="hljs-class">                <span class="hljs-title">input_channels</span>, <span class="hljs-title">output_channels</span>, <span class="hljs-title">kernel_size</span>=1, <span class="hljs-title">stride</span>=<span class="hljs-title">conv1_stride</span>)</span><br><span class="hljs-class">        else:</span><br><span class="hljs-class">            self.conv1x1 = <span class="hljs-type">None</span></span><br><span class="hljs-class"></span><br><span class="hljs-class">    def forward(<span class="hljs-title">self</span>, <span class="hljs-type">X</span>):</span><br><span class="hljs-class">        <span class="hljs-type">Y</span> = <span class="hljs-type">F</span>.relu(<span class="hljs-title">self</span>.<span class="hljs-title">bn1</span>(<span class="hljs-title">self</span>.<span class="hljs-title">conv1</span>(<span class="hljs-type">X</span>)))</span><br><span class="hljs-class">        <span class="hljs-type">Y</span> = (<span class="hljs-title">self</span>.<span class="hljs-title">bn2</span>(<span class="hljs-title">self</span>.<span class="hljs-title">conv2</span>(<span class="hljs-type">Y</span>)))</span><br><span class="hljs-class">        if self.conv1x1:</span><br><span class="hljs-class">            <span class="hljs-type">X</span> = self.conv1x1(<span class="hljs-type">X</span>)</span><br><span class="hljs-class">        <span class="hljs-type">Y</span> += <span class="hljs-type">X</span></span><br><span class="hljs-class">        return <span class="hljs-type">F</span>.relu(<span class="hljs-type">Y</span>)</span><br><span class="hljs-class"></span><br></code></pre></td></tr></table></figure><h3 id="3-åˆå§‹å·ç§¯å±‚"><a href="#3-åˆå§‹å·ç§¯å±‚" class="headerlink" title="3. åˆå§‹å·ç§¯å±‚"></a>3. åˆå§‹å·ç§¯å±‚</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-keyword">class</span> stem(nn.<span class="hljs-title class_">Module</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span>, input_channels, output_channels</span>) -&gt; <span class="hljs-title class_">None</span>:<br>        <span class="hljs-variable language_">super</span>().__init__()<br>        <span class="hljs-variable language_">self</span>.conv = nn.<span class="hljs-title class_">Conv2d</span>(input_channels, output_channels,<br>                              kernel_size=(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>), padding=(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>), stride=<span class="hljs-number">1</span>)<br>        <span class="hljs-variable language_">self</span>.bn = nn.<span class="hljs-title class_">BatchNorm2d</span>(output_channels)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span>, X</span>):<br>        <span class="hljs-keyword">return</span> F.relu(<span class="hljs-variable language_">self</span>.bn(<span class="hljs-variable language_">self</span>.conv(X)))<br></code></pre></td></tr></table></figure><h3 id="4-å buff"><a href="#4-å buff" class="headerlink" title="4. å buff"></a>4. å buff</h3><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword">class</span> model(<span class="hljs-title">nn</span>.<span class="hljs-type">Module</span>):</span><br><span class="hljs-class">    def __init__(<span class="hljs-title">self</span>) -&gt; <span class="hljs-type">None</span>:</span><br><span class="hljs-class">        super().__init__()</span><br><span class="hljs-class">        self.embed=nn.<span class="hljs-type">Embedding</span>(256,119)</span><br><span class="hljs-class">        self.stem=stem(1,16)</span><br><span class="hljs-class">        self.ress=nn.<span class="hljs-type">Sequential</span>(</span><br><span class="hljs-class">            <span class="hljs-type">Residual</span>(16, 32, 1, 1, <span class="hljs-title">use_1x1conv</span>=<span class="hljs-type">True</span>),</span><br><span class="hljs-class">            <span class="hljs-type">Residual</span>(32, 128, 2, 1, <span class="hljs-title">use_1x1conv</span>=<span class="hljs-type">True</span>),</span><br><span class="hljs-class">            <span class="hljs-type">Residual</span>(128, 256, 2, 1, <span class="hljs-title">use_1x1conv</span>=<span class="hljs-type">True</span>),</span><br><span class="hljs-class">            <span class="hljs-type">Residual</span>(256, 512, 2, 1, <span class="hljs-title">use_1x1conv</span>=<span class="hljs-type">True</span>),</span><br><span class="hljs-class">        )</span><br><span class="hljs-class">        self.avgpool=nn.<span class="hljs-type">AdaptiveAvgPool2d</span>(1)</span><br><span class="hljs-class">        self.linear=nn.<span class="hljs-type">Sequential</span>(</span><br><span class="hljs-class">            <span class="hljs-title">nn</span>.<span class="hljs-type">Flatten</span>(),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Linear</span>(512,26)</span><br><span class="hljs-class">        )</span><br><span class="hljs-class">    def forward(<span class="hljs-title">self</span>,<span class="hljs-type">X</span>):</span><br><span class="hljs-class">        <span class="hljs-type">X</span>=self.embed(<span class="hljs-type">X</span>)</span><br><span class="hljs-class">        <span class="hljs-type">X</span>=self.stem(<span class="hljs-type">X</span>)</span><br><span class="hljs-class">        <span class="hljs-type">X</span>=self.ress(<span class="hljs-type">X</span>)</span><br><span class="hljs-class">        return self.linear(<span class="hljs-title">self</span>.<span class="hljs-title">avgpool</span>(<span class="hljs-type">X</span>))</span><br></code></pre></td></tr></table></figure><h2 id="å››-è®­ç»ƒ"><a href="#å››-è®­ç»ƒ" class="headerlink" title="å››. è®­ç»ƒ"></a>å››. è®­ç»ƒ</h2><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs leaf">def train(model, device, train_loader, optimizer, criterion,scheduler):<br>    time_start=time.time()<br>    predictions = []<br>    targets = []<br>    train_recall=[]<br>    train_acc=[]<br>    train_loss=[]<br>    model.train()<br>    for batch, datas in enumerate(train_loader):<br>        <span class="hljs-punctuation">#</span><span class="hljs-keyword">print</span><span class="hljs-params">(<span class="hljs-string">&quot;batch numbers:&#123;&#125;&quot;</span>.<span class="hljs-keyword">format</span><span class="hljs-params">(<span class="hljs-keyword">len</span><span class="hljs-params">(<span class="hljs-variable">train_loader</span>)</span>)</span>)</span><br>        x, y = datas<br>        if device == &#x27;cuda&#x27;:<br>            x, y = x.cuda(), y.cuda()<br><br>        <span class="hljs-punctuation">#</span> è¾“å…¥ä¸€ä¸ªæ‰¹é‡çš„æ•°æ®ï¼Œx.shapeä¸º[batch_size,num_features]<br>        y_hat,featuremap = model(x.reshape(-1, 1, 119).long())<br>        <span class="hljs-punctuation">#</span> print(featuremap,featuremap.size())<br>        del featuremap<br>        <span class="hljs-punctuation">#</span> è¾“å‡ºä¸ºæ‰¹é‡ä¸­æ¯ä¸ªå…ƒç´ çš„é¢„æµ‹å€¼ï¼Œy_hat.shapeä¸º[batch_size,num_classes]<br>        _, pre_y = torch.max(y_hat, dim=1)<br>        loss = criterion(y_hat, y)<br>        acc = torch.sum(y == pre_y)<br>        <span class="hljs-punctuation">#</span> recall=recall_score(pre_y,y,average=&#x27;micro&#x27;)<br>        y,pre_y,acc=y.cpu(),pre_y.cpu(),acc.cpu()<br>        recall=recall_score(y,pre_y,average=metrix_mode,zero_division=1)<br>        <br>        train_recall.append(recall)<br>        train_acc.append(acc)<br>        loss.backward()<br>        optimizer.step()<br>        optimizer.zero_grad()<br>        train_loss.append(loss.cpu().data)<br>        predictions.extend(pre_y.cpu().numpy())<br>        targets.extend(y.cpu().numpy())<br>        scheduler.step()<br>        if (batch+1)%20==0:<br>            time_end=time.time()<br>            <span class="hljs-punctuation">#</span><span class="hljs-keyword">print</span><span class="hljs-params">(<span class="hljs-string">&quot;pre:&#123;&#125;,target:&#123;&#125;&quot;</span>.<span class="hljs-keyword">format</span><span class="hljs-params">(<span class="hljs-variable">predictions</span>,<span class="hljs-variable">targets</span>)</span>)</span><br>            <span class="hljs-punctuation">#</span><span class="hljs-keyword">print</span><span class="hljs-params">(<span class="hljs-string">&quot;pre:&quot;</span>,<span class="hljs-keyword">Counter</span><span class="hljs-params">(<span class="hljs-variable">predictions</span>)</span>)</span><br>            <span class="hljs-punctuation">#</span><span class="hljs-keyword">print</span><span class="hljs-params">(<span class="hljs-string">&quot;tar:&quot;</span>,<span class="hljs-keyword">Counter</span><span class="hljs-params">(<span class="hljs-variable">targets</span>)</span>)</span><br>            print(&quot;batch:&#123;&#125;/&#123;&#125;,loss:&#123;:.5f&#125;,train_recall:&#123;:.5f&#125;,train_acc:&#123;:.5f&#125;,time cost:&#123;:.2f&#125;&quot;.format(<br>                batch+1,<br>                len(train_loader),<br>                np.mean(train_loss)/batch_size,<br>                np.mean(train_recall),<br>                np.mean(train_acc)/batch_size,<br>                time_end-time_start))<br>            time_start=time.time()<br>    f1 = f1_score(targets, predictions,average=metrix_mode,zero_division=1)<br>    precision = precision_score(targets, predictions,average=metrix_mode,zero_division=1)<br>    accuracy = accuracy_score(targets, predictions)<br>    recall = recall_score(targets, predictions,average=metrix_mode,zero_division=1)<br><br>    return f1, precision, accuracy, recall<br></code></pre></td></tr></table></figure><h2 id="äº”-éªŒè¯"><a href="#äº”-éªŒè¯" class="headerlink" title="äº”. éªŒè¯"></a>äº”. éªŒè¯</h2><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs leaf">def evaluate(model, device, data_loader,criterion):<br>    model.eval()<br>    predictions = []<br>    targets = []<br>    valid_loss=[]<br>    with torch.no_grad():<br>        for batch,datas in enumerate(data_loader):<br>            data,target=datas<br>            data, target = data.to(device), target.to(device)<br>            output,featuremap = model(data.reshape(-1,1,119).long())<br>            del featuremap<br>            loss=criterion(output,target)<br>            valid_loss.append(loss.cpu().data)<br>            pred = output.argmax(dim=1, keepdim=True)<br>            <br>            predictions.extend(pred.cpu().numpy())<br>            targets.extend(target.cpu().numpy())<br>            if (batch+1)%5==0:<br>                print(&quot;batch&#123;&#125;,valid loss:&#123;:.5f&#125;,valid acc:&#123;:.4f&#125;&quot;.format(<br>                        batch+1,np.mean(valid_loss)/batch_size,accuracy_score(targets, predictions)))<br><br>    f1 = f1_score(targets, predictions,average=metrix_mode,zero_division=1)<br>    precision = precision_score(targets, predictions,average=metrix_mode,zero_division=1)<br>    accuracy = accuracy_score(targets, predictions)<br>    recall = recall_score(targets, predictions,average=metrix_mode,zero_division=1)<br>    <span class="hljs-punctuation">#</span><span class="hljs-keyword">print</span><span class="hljs-params">(<span class="hljs-keyword">Counter</span><span class="hljs-params">(<span class="hljs-variable">predictions</span>)</span>)</span><br>    <span class="hljs-punctuation">#</span><span class="hljs-keyword">print</span><span class="hljs-params">(<span class="hljs-keyword">Counter</span><span class="hljs-params">(<span class="hljs-variable">targets</span>)</span>)</span><br>    return f1, precision, accuracy, recall<br></code></pre></td></tr></table></figure><h2 id="å…­-è®­ç»ƒ-k-fold-crossValidation"><a href="#å…­-è®­ç»ƒ-k-fold-crossValidation" class="headerlink" title="å…­. è®­ç»ƒ+k-fold-crossValidation"></a>å…­. è®­ç»ƒ+k-fold-crossValidation</h2><p><code>skf=KFold(n_splits=k,shuffle=True,random_state=8)</code>  </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># start training</span><br>f1_scores=[]<br>precision_scores=[]<br>accuracy_scores=[]<br>recall_scores=[]<br><br><span class="hljs-keyword">for</span> fold, (train_indices, test_indices) <span class="hljs-keyword">in</span> enumerate(skf.split(train_set_full)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Fold&#123;&#125;/&#123;&#125;&quot;</span>.format(fold+1, k))<br><br>    <span class="hljs-attribute">train_sampler</span>=torch.utils.data.WeightedRandomSampler(<br>        weights[train_indices],<br>        40000,<br>        <span class="hljs-literal">True</span><br>    )<br>    <span class="hljs-attribute">test_sampler</span>=torch.utils.data.WeightedRandomSampler(<br>        weights[test_indices],<br>        10000,<br>        <span class="hljs-literal">True</span><br>    )<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;init sampler success&quot;</span>)<br>    train_loader = torch.utils.data.DataLoader(<br>        torch.utils.data.Subset(train_set_full, train_indices),<br>        <span class="hljs-attribute">shuffle</span>=<span class="hljs-literal">True</span>,<br>        <span class="hljs-attribute">batch_size</span>=batch_size, <br>        )<br>    <span class="hljs-attribute">valid_loader</span>=torch.utils.data.DataLoader(<br>        torch.utils.data.Subset(train_set_full,test_indices),<br>        <span class="hljs-attribute">batch_size</span>=batch_size,<br>    )<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;init dataloader success&quot;</span>)<br>    module = model()<br>    module = module.<span class="hljs-keyword">to</span>(<span class="hljs-attribute">device</span>=device)<br>    loss_f = torch.nn.CrossEntropyLoss()<br>    loss_f = loss_f.<span class="hljs-keyword">to</span>(<span class="hljs-attribute">device</span>=device)<br>    opt = torch.optim.Adam(module.parameters(), <span class="hljs-attribute">lr</span>=learning_rate)<br>   <span class="hljs-built_in"> scheduler </span>= torch.optim.lr_scheduler.CosineAnnealingWarmRestarts(<br>            <span class="hljs-attribute">eta_min</span>=1e-6,<br>            <span class="hljs-attribute">optimizer</span>=opt,<br>            <span class="hljs-attribute">T_0</span>=5)<br>    <br>    <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> range(epoche_num):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;epoch:&#123;&#125;/&#123;&#125;&quot;</span>.format(epoch+1,epoche_num))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----training----&quot;</span>)<br>        train(<span class="hljs-attribute">model</span>=module,<br>              <span class="hljs-attribute">device</span>=device,<br>              <span class="hljs-attribute">train_loader</span>=train_loader,<br>              <span class="hljs-attribute">optimizer</span>=opt,<br>              <span class="hljs-attribute">criterion</span>=loss_f,<br>              <span class="hljs-attribute">scheduler</span>=scheduler)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;train finished,begin valid&quot;</span>)<br>        evaluate(module, <br>                 device, <br>                 valid_loader,<br>                 loss_f)<br>        <br>    <span class="hljs-attribute">time_foldstart</span>=time.time()<br>    f1, precision, accuracy, recall = evaluate(module, device, valid_loader,loss_f)<br>    <span class="hljs-attribute">time_foldend</span>=time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;time cost:&#123;:.2f&#125;&quot;</span>.format(time_foldend-time_foldstart))<br>    <span class="hljs-built_in">print</span>(f<span class="hljs-string">&quot;F1-score: &#123;f1&#125;&quot;</span>)<br>    <span class="hljs-built_in">print</span>(f<span class="hljs-string">&quot;Precision: &#123;precision&#125;&quot;</span>)<br>    <span class="hljs-built_in">print</span>(f<span class="hljs-string">&quot;Accuracy: &#123;accuracy&#125;&quot;</span>)<br>    <span class="hljs-built_in">print</span>(f<span class="hljs-string">&quot;Recall: &#123;recall&#125;&quot;</span>)<br><br>    # Append the evaluation metrics <span class="hljs-keyword">to</span> the lists<br>    f1_scores.append(f1)<br>    precision_scores.append(precision)<br>    accuracy_scores.append(accuracy)<br>    recall_scores.append(recall)<br>torch.save(module,<span class="hljs-string">&#x27;module&#x27;</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo+Fluid+Github</title>
    <link href="/2024/01/01/hexo+github%E4%BD%BF%E7%94%A8/"/>
    <url>/2024/01/01/hexo+github%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>Welcome to my first blog! </p><p>This blog is written to introduce and record the basic use of hexo, as well as posting blog to github.  </p><p>In order to deploy blog on github.io, Nodejs and Hexo are required to be installed in your computer.  </p><p>Additionally, this blog also introduce the SSH connecting from local computer to your github accounts. </p><h2 id="å‘åšå®¢"><a href="#å‘åšå®¢" class="headerlink" title="å‘åšå®¢"></a>å‘åšå®¢</h2><ol><li><p>æ¯æ¬¡åœ¨sourceå†™å®Œåšå®¢åï¼Œåœ¨rootç›®å½•ä¸‹ä½¿ç”¨ <code>hexo g</code> ç”Ÿæˆé¡µé¢  </p></li><li><p>ç„¶åå¯ä»¥é€‰æ‹©ä½¿ç”¨<code>hexo s</code>æœ¬åœ°è¿›è¡Œé¢„è§ˆ  </p></li><li><p>ä½¿ç”¨<code>hexo d</code>æ¨é€åˆ°github.io</p></li></ol><h2 id="æ›´æ¢ä¸»é¢˜"><a href="#æ›´æ¢ä¸»é¢˜" class="headerlink" title="æ›´æ¢ä¸»é¢˜"></a>æ›´æ¢ä¸»é¢˜</h2><ol><li><p>æ ¹æ®æ¯ä¸ªthemeä¸åŒçš„éœ€æ±‚è¿›è¡Œå®‰è£…</p></li><li><p>éœ€è¦ä¿®æ”¹åŸ_config.yamlæ–‡ä»¶ä¸­çš„é…ç½®  </p><blockquote><p>ä¿®æ”¹authorç­‰ä¿¡æ¯ï¼Œå¯¹åº”åˆ°æ¯ç¯‡æ–‡ç« æœ«å°¾çš„ä¿¡æ¯æˆ³   </p></blockquote></li><li><p>æ–°å»º_config.themeName.yml,å°†ç›®æ ‡themeçš„configå†…å®¹å¤åˆ¶è¿›è¯¥æ–‡ä»¶ä¸­</p><ol><li>æ–°å»ºymlçš„æ–¹å¼ã€æ–°å»ºè®°äº‹æœ¬ã€vscodeæ‰“å¼€ã€å¦å­˜ä¸º.ymlæ–‡ä»¶ã€‘</li></ol></li></ol><h3 id="ä»¥æ›´æ¢fluidä¸»é¢˜ä¸ºä¾‹"><a href="#ä»¥æ›´æ¢fluidä¸»é¢˜ä¸ºä¾‹" class="headerlink" title="ä»¥æ›´æ¢fluidä¸»é¢˜ä¸ºä¾‹"></a>ä»¥æ›´æ¢fluidä¸»é¢˜ä¸ºä¾‹</h3><h4 id="å®‰è£…ç›®æ ‡ä¸»é¢˜"><a href="#å®‰è£…ç›®æ ‡ä¸»é¢˜" class="headerlink" title="å®‰è£…ç›®æ ‡ä¸»é¢˜"></a>å®‰è£…ç›®æ ‡ä¸»é¢˜</h4><blockquote><p>npm install â€“save hexo-theme-fluid</p></blockquote><h4 id="ä¿®æ”¹hexoåšå®¢ç›®å½•ä¸­çš„-config-yml"><a href="#ä¿®æ”¹hexoåšå®¢ç›®å½•ä¸­çš„-config-yml" class="headerlink" title="ä¿®æ”¹hexoåšå®¢ç›®å½•ä¸­çš„_config.yml"></a>ä¿®æ”¹hexoåšå®¢ç›®å½•ä¸­çš„_config.yml</h4><blockquote><p>theme: fluid  &#x2F;&#x2F;åŸæ¥ä¸ºlandscape  </p><p>language: zh-CN &#x2F;&#x2F; åŸæ¥ä¸ºEN</p></blockquote><h4 id="å…¶ä»–ä½¿ç”¨æœªå®Œå¾…ç»­"><a href="#å…¶ä»–ä½¿ç”¨æœªå®Œå¾…ç»­" class="headerlink" title="å…¶ä»–ä½¿ç”¨æœªå®Œå¾…ç»­"></a>å…¶ä»–ä½¿ç”¨æœªå®Œå¾…ç»­</h4><p>è¯¦æƒ…è¯·è§<a href="https://hexo.fluid-dev.com/">fluidä¸»é¢˜å®˜ç½‘</a></p><h2 id="ä¸githubæ­é…ä½¿ç”¨"><a href="#ä¸githubæ­é…ä½¿ç”¨" class="headerlink" title="ä¸githubæ­é…ä½¿ç”¨"></a>ä¸githubæ­é…ä½¿ç”¨</h2><h3 id="å»ºç«‹ä»“åº“"><a href="#å»ºç«‹ä»“åº“" class="headerlink" title="å»ºç«‹ä»“åº“"></a>å»ºç«‹ä»“åº“</h3><pre><code class="hljs">1. åœ¨githubæ–°å»ºä»“åº“ï¼Œå–åä¸ºlightningSr.github.io2. å°†è¯¥ä»“åº“çš„settingä¸­é…ç½®ä¸ºSSH</code></pre><h3 id="é…ç½®SSH"><a href="#é…ç½®SSH" class="headerlink" title="é…ç½®SSH"></a>é…ç½®SSH</h3><h4 id="Â·æœ¬åœ°SSH"><a href="#Â·æœ¬åœ°SSH" class="headerlink" title="Â·æœ¬åœ°SSH"></a>Â·æœ¬åœ°SSH</h4><ol><li><p>é…ç½®git  </p><p> <code>git config --global user.name &quot;lightningSr&quot;</code>  </p><p> <code>git config --global user.email &quot;15110281946@163.com&quot;</code></p></li><li><p>ç”ŸæˆSSH  </p><p> <code>ssh-keygen -t rsa -C &quot;15110281946@163.com&quot; </code>  </p><pre><code class="hljs"> Â·ç”Ÿæˆå¯†é’¥ï¼ŒæˆåŠŸæ ‡å¿—æ˜¯å‘½ä»¤è¡Œè§åˆ°ä»¥é‚®ç®±ç»“å°¾çš„rsaå¯†é’¥å’Œç­¾åä¿¡æ¯   Â·ç”Ÿæˆçš„å¯†é’¥å†™å…¥äº†.ssh\id_rsa.pubæ–‡ä»¶ä¸­</code></pre></li><li><p>å¤åˆ¶SSHï¼Œå‡†å¤‡é…ç½®githubä¿¡æ¯ã€windowsã€‘  </p><p> <code>type C:\Users\lightning\.ssh\id_rsa.pub | clip</code></p></li></ol><h4 id="Â·githubé…ç½®SSH"><a href="#Â·githubé…ç½®SSH" class="headerlink" title="Â·githubé…ç½®SSH"></a>Â·githubé…ç½®SSH</h4><pre><code class="hljs">åœ¨github-setting-SSH and GPG keys ä¸­ï¼Œé€‰æ‹©new SSH key  å°†åˆšåˆšå¤åˆ¶çš„å¯†é’¥ç²˜è´´è¿›å»</code></pre><h4 id="Â·éªŒè¯"><a href="#Â·éªŒè¯" class="headerlink" title="Â·éªŒè¯"></a>Â·éªŒè¯</h4><pre><code class="hljs">ç»ˆç«¯ä¸­è¾“å…¥ `ssh -T git@github.com`</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Fluid</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
